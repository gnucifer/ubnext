<?php
/**
 * @file
 * Code for the UBN Terms feature.
 */

include_once 'ubn_terms.features.inc';

function ubn_terms_entity_info_alter(&$entity_info) {
  $entity_info['taxonomy_term']['view modes']['ubn_terms_search_result'] = array(
    'label' => t('UBN Terms search result'),
    'custom settings' => FALSE,
  );
}

function ubn_terms_safe_css_identifier($data) {
  $tmp = unpack('H*', $data);
  return array_shift($tmp);
}

/**
 * Implements hook_ctools_plugin_directory().
 */
function ubn_terms_ctools_plugin_directory($owner, $plugin_type) {
  if (in_array($plugin_type, array('content_types'))) {
    return "plugins/$plugin_type";
  }
}

/**
 * Implements hook_query_TAG_alter().
 *
 * Super ugly hack, but what to do?
 *
 * @param QueryAlterableInterface $query
 */
function ubn_terms_query_UBN_TERMS_ORDER_BY_FIELD_LANGUAGE_CONDITION_alter(QueryAlterableInterface $query) {
  global $language_content;
  //Hackelyhack
  list($order_by) = array_keys($query->getOrderby());
  list($alias) = explode('.', $order_by);
  $query->condition("$alias.language", $language_content->language, '=');
}
